<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VocaMaster - TOEFL Flashcards</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', 'Noto Sans KR', sans-serif; background-color: #f0f4f8; overflow-x: hidden; }
        .card-container { perspective: 1000px; }
        .card { position: relative; transform-style: preserve-3d; transition: transform 0.6s; }
        .card.flipped { transform: rotateY(180deg); }
        .card-face { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; -webkit-backface-visibility: hidden; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; padding: 1.5rem; border-radius: 1.5rem; }
        .card-front { background-color: #ffffff; color: #1e293b; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); }
        .card-back { background-color: #4f46e5; color: white; transform: rotateY(180deg); box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); }
        
        /* ì‚¬ì´ë“œë°” ìŠ¤íƒ€ì¼ */
        #sidebar { transition: transform 0.3s ease-in-out; }
        #sidebar.open { transform: translateX(0); }
        #sidebar.closed { transform: translateX(-100%); }
        
        /* ìŠ¤í¬ë¡¤ë°” ì»¤ìŠ¤í…€ */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #c7c7c7; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #a8a8a8; }
    </style>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col relative">

    <div id="login-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center hidden">
        <div class="bg-white p-6 rounded-lg shadow-xl w-80">
            <h2 class="text-xl font-bold mb-4">ë™ê¸°í™” ID ì…ë ¥</h2>
            <p class="text-gray-600 text-sm mb-4">PCì™€ í°ì—ì„œ ê°™ì€ IDë¥¼ ì…ë ¥í•˜ë©´ í•™ìŠµ ê¸°ë¡ì´ ë™ê¸°í™”ë©ë‹ˆë‹¤.</p>
            <input type="text" id="sync-id-input" placeholder="ì˜ˆ: my-voca-01" class="w-full border p-2 rounded mb-4">
            <button onclick="saveSyncId()" class="w-full bg-indigo-600 text-white p-2 rounded hover:bg-indigo-700">ì‹œì‘í•˜ê¸°</button>
        </div>
    </div>

    <div id="sidebar-overlay" class="fixed inset-0 bg-black bg-opacity-50 z-30 hidden" onclick="toggleSidebar()"></div>
    
    <div id="sidebar" class="fixed top-0 left-0 h-full w-80 bg-white shadow-2xl z-40 closed overflow-y-auto p-4">
        <div class="flex justify-between items-center mb-6">
            <h2 class="text-xl font-bold text-gray-800">ë‹¨ì–´ ëª©ë¡</h2>
            <button onclick="toggleSidebar()" class="text-gray-500 hover:text-gray-800"><i class="fas fa-times text-xl"></i></button>
        </div>
        <div id="sidebar-content" class="space-y-4"></div>
    </div>

    <header class="w-full bg-white shadow-sm p-4 flex items-center justify-between sticky top-0 z-20">
        <button onclick="toggleSidebar()" class="text-slate-600 text-xl p-2"><i class="fas fa-bars"></i></button>
        <h1 class="text-lg md:text-xl font-bold text-slate-800">VocaMaster</h1>
        <div class="w-8"></div> </header>

    <main class="flex-grow flex flex-col items-center justify-start p-4 w-full max-w-2xl mx-auto mt-4">
        
        <div class="w-full bg-white rounded-xl p-4 shadow-sm mb-6">
            <div class="flex flex-wrap gap-2 justify-center mb-3">
                <span class="text-xs font-bold text-gray-500 self-center mr-2">ë³´ê¸°:</span>
                <button onclick="setFilter('all')" id="btn-filter-all" class="px-3 py-1 text-sm rounded-full bg-indigo-600 text-white transition">ì „ì²´</button>
                <button onclick="setFilter('unknown')" id="btn-filter-unknown" class="px-3 py-1 text-sm rounded-full bg-gray-200 text-gray-700 transition">ğŸ”´ ëª»ì™¸ì›€</button>
                <button onclick="setFilter('ambiguous')" id="btn-filter-ambiguous" class="px-3 py-1 text-sm rounded-full bg-gray-200 text-gray-700 transition">ğŸŸ¡ ì• ë§¤í•¨</button>
                <button onclick="setFilter('memorized')" id="btn-filter-memorized" class="px-3 py-1 text-sm rounded-full bg-gray-200 text-gray-700 transition">ğŸŸ¢ ì™¸ì›€</button>
            </div>
            <div class="flex items-center justify-center gap-4 text-sm text-gray-600">
                <label class="flex items-center cursor-pointer">
                    <input type="checkbox" id="mode-toggle" class="mr-2" onchange="toggleMode()">
                    <span>í•œê¸€ ë¨¼ì € ë³´ê¸° (Reverse)</span>
                </label>
            </div>
        </div>

        <div class="card-container h-80 w-full mb-4 cursor-pointer relative" onclick="flipCard()">
            <div id="card" class="card w-full h-full">
                <div class="card-face card-front relative">
                    <span id="card-difficulty" class="absolute top-4 right-4 text-xs font-bold px-2 py-1 rounded bg-gray-100 text-gray-500">Medium</span>
                    <span id="card-part" class="absolute top-4 left-4 text-xs italic text-gray-400">verb</span>
                    <h2 id="card-main-text" class="text-4xl font-bold break-keep">Promote</h2>
                </div>
                <div class="card-face card-back">
                    <h2 id="card-sub-text" class="text-3xl font-bold mb-4 break-keep">í™ë³´í•˜ë‹¤</h2>
                    <p id="card-desc-text" class="text-base font-medium opacity-90 break-keep">to encourage</p>
                </div>
            </div>
        </div>

        <div id="example-area" class="w-full bg-indigo-50 rounded-lg p-4 mb-6 hidden transition-all">
            <p class="text-indigo-900 font-medium text-center italic">"<span id="example-text"></span>"</p>
        </div>
        <button onclick="toggleExample()" class="text-indigo-600 text-sm font-semibold mb-6 hover:underline">
            <i class="far fa-eye mr-1"></i> ì˜ˆë¬¸ ë³´ê¸° / ìˆ¨ê¸°ê¸°
        </button>

        <div class="grid grid-cols-3 gap-3 w-full mb-8">
            <button onclick="updateStatus('unknown')" id="btn-status-unknown" class="p-3 rounded-lg border-2 border-red-100 hover:bg-red-50 text-red-600 font-bold transition">
                ğŸ”´ ëª°ë¼ìš”
            </button>
            <button onclick="updateStatus('ambiguous')" id="btn-status-ambiguous" class="p-3 rounded-lg border-2 border-yellow-100 hover:bg-yellow-50 text-yellow-600 font-bold transition">
                ğŸŸ¡ ì• ë§¤í•´ìš”
            </button>
            <button onclick="updateStatus('memorized')" id="btn-status-memorized" class="p-3 rounded-lg border-2 border-green-100 hover:bg-green-50 text-green-600 font-bold transition">
                ğŸŸ¢ ì™¸ì› ì–´ìš”
            </button>
        </div>

        <div class="flex items-center justify-center space-x-6 mb-8">
            <button onclick="prevCard()" class="w-12 h-12 rounded-full bg-white shadow text-gray-600 hover:bg-gray-50"><i class="fas fa-chevron-left"></i></button>
            <span id="card-counter" class="text-gray-500 font-mono">1 / 10</span>
            <button onclick="nextCard()" class="w-12 h-12 rounded-full bg-indigo-600 shadow text-white hover:bg-indigo-700"><i class="fas fa-chevron-right"></i></button>
        </div>

    </main>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        // ==========================================
        // [í•„ìˆ˜] ì•„ë˜ ê°ì²´ë¥¼ Firebase ì½˜ì†” ê°’ìœ¼ë¡œ êµì²´í•˜ì„¸ìš”!
        // ==========================================
        const firebaseConfig = {
            apiKey: "AIzaSyAoLwWDvszFSxKxrrRgts2sxhKtmalAm94",
            authDomain: "my-toefl-voca.firebaseapp.com",
            projectId: "my-toefl-voca",
            storageBucket: "my-toefl-voca.firebasestorage.app",
            messagingSenderId: "929048950334",
            appId: "1:929048950334:web:d33177785663a9dd22c36f",
            measurementId: "G-TVDZVQJECG"
        };

        // Firebase ì´ˆê¸°í™”
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        // ì „ì—­ ë³€ìˆ˜ ì„¤ì • (window ê°ì²´ì— í• ë‹¹í•˜ì—¬ ëª¨ë“ˆ ë°–ì—ì„œë„ ì ‘ê·¼ ê°€ëŠ¥í•˜ê²Œ í•¨)
        window.db = db;
        window.ref = ref;
        window.set = set;
        window.onValue = onValue;
        
        // ì•± ì‹œì‘
        initApp();
    </script>

    <script>
        // --- ë°ì´í„° (JSON) ---
        const rawVocabulary = [
            { "Word": "promote", "Part of Speech": "verb", "Difficulty": "medium", "Korean Definition": "í™ë³´í•˜ë‹¤, ì´‰ì§„í•˜ë‹¤", "English Definition": "to further the progress of something", "Example Sentence": "The organization works to promote healthy eating habits." },
            { "Word": "proportion", "Part of Speech": "noun", "Difficulty": "hard", "Korean Definition": "ë¹„ìœ¨, ë¶€ë¶„, ê· í˜•", "English Definition": "the size or amount of something compared to the whole", "Example Sentence": "Cartoons often have exaggerated proportions." },
            { "Word": "pursue", "Part of Speech": "verb", "Difficulty": "hard", "Korean Definition": "ì¶”êµ¬í•˜ë‹¤, ë’¤ì«“ë‹¤", "English Definition": "to try to achieve; to follow", "Example Sentence": "Man pursued the dream of flight for hundreds of years." },
            { "Word": "capacity", "Part of Speech": "noun", "Difficulty": "medium", "Korean Definition": "ìˆ˜ìš© ëŠ¥ë ¥, ìš©ëŸ‰", "English Definition": "the maximum amount that something can contain.", "Example Sentence": "The stadium has a seating capacity of 50,000." },
            { "Word": "efficient", "Part of Speech": "adj", "Difficulty": "easy", "Korean Definition": "íš¨ìœ¨ì ì¸", "English Definition": "achieving maximum productivity with minimum wasted effort", "Example Sentence": "Fluorescent lamps are efficient at converting electricity into light." }
        ];

        // --- ìƒíƒœ ë³€ìˆ˜ ---
        let userSyncId = localStorage.getItem('voca_sync_id');
        let statusData = {}; // Firebaseì—ì„œ ê°€ì ¸ì˜¨ ìƒíƒœ ë°ì´í„° { "promote": "memorized", ... }
        let currentList = []; // í˜„ì¬ í•„í„°ë§ëœ ë‹¨ì–´ ë¦¬ìŠ¤íŠ¸
        let currentIndex = 0;
        let currentFilter = 'all'; // all, unknown, ambiguous, memorized
        let isReverseMode = false;

        // --- ì´ˆê¸°í™” í•¨ìˆ˜ ---
        function initApp() {
            if (!userSyncId) {
                document.getElementById('login-modal').classList.remove('hidden');
            } else {
                startSync();
            }
        }

        window.saveSyncId = function() {
            const input = document.getElementById('sync-id-input').value.trim();
            if(input) {
                userSyncId = input;
                localStorage.setItem('voca_sync_id', input);
                document.getElementById('login-modal').classList.add('hidden');
                startSync();
            } else {
                alert("IDë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
            }
        }

        function startSync() {
            // Firebase ì‹¤ì‹œê°„ ë¦¬ìŠ¤ë„ˆ ì—°ê²°
            const starCountRef = window.ref(window.db, 'users/' + userSyncId);
            window.onValue(starCountRef, (snapshot) => {
                const data = snapshot.val();
                statusData = data || {}; // ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ë¹ˆ ê°ì²´
                applyFilter(); // ë°ì´í„° ë³€ê²½ ì‹œ í™”ë©´ ê°±ì‹ 
                renderSidebar(); // ì‚¬ì´ë“œë°” ê°±ì‹ 
            });
        }

        // --- í•„í„° ë° ë¦¬ìŠ¤íŠ¸ ë¡œì§ ---
        window.setFilter = function(filterType) {
            currentFilter = filterType;
            
            // ë²„íŠ¼ ìŠ¤íƒ€ì¼ ì—…ë°ì´íŠ¸
            ['all', 'unknown', 'ambiguous', 'memorized'].forEach(t => {
                const btn = document.getElementById(`btn-filter-${t}`);
                if(t === filterType) {
                    btn.classList.remove('bg-gray-200', 'text-gray-700');
                    btn.classList.add('bg-indigo-600', 'text-white');
                } else {
                    btn.classList.add('bg-gray-200', 'text-gray-700');
                    btn.classList.remove('bg-indigo-600', 'text-white');
                }
            });

            applyFilter();
        }

        function applyFilter() {
            // ë°ì´í„° ê°€ê³µ: rawVocabularyì— status ì •ë³´ ê²°í•©
            const combinedData = rawVocabulary.map(item => {
                const status = statusData[item.Word] || 'unknown'; // ê¸°ë³¸ê°’ unknown
                return { ...item, status: status };
            });

            if (currentFilter === 'all') {
                currentList = combinedData;
            } else {
                currentList = combinedData.filter(item => item.status === currentFilter);
            }

            // ì¸ë±ìŠ¤ ì´ˆê¸°í™” ë° ì¹´ë“œ ë Œë”ë§
            currentIndex = 0;
            if (currentList.length === 0) {
                renderEmpty();
            } else {
                renderCard();
            }
        }

        // --- ë Œë”ë§ ë¡œì§ ---
        function renderCard() {
            if(currentList.length === 0) return;
            const item = currentList[currentIndex];
            const card = document.getElementById('card');
            
            // ì¹´ë“œ ë’¤ì§‘í˜ ìƒíƒœ ì´ˆê¸°í™”
            card.classList.remove('flipped');
            
            // ì˜ˆë¬¸ ìˆ¨ê¸°ê¸°
            document.getElementById('example-area').classList.add('hidden');

            setTimeout(() => {
                // í…ìŠ¤íŠ¸ ì„¤ì •
                document.getElementById('card-difficulty').innerText = item.Difficulty.toUpperCase();
                document.getElementById('card-part').innerText = item['Part of Speech'];
                document.getElementById('example-text').innerText = item['Example Sentence'];

                if (isReverseMode) {
                    document.getElementById('card-main-text').innerText = item['Korean Definition'].split(',')[0]; // ì²« ë²ˆì§¸ ëœ»ë§Œ í¬ê²Œ
                    document.getElementById('card-sub-text').innerText = item.Word;
                    document.getElementById('card-desc-text').innerText = item['English Definition'];
                } else {
                    document.getElementById('card-main-text').innerText = item.Word;
                    document.getElementById('card-sub-text').innerText = item['Korean Definition'];
                    document.getElementById('card-desc-text').innerText = item['English Definition'];
                }

                document.getElementById('card-counter').innerText = `${currentIndex + 1} / ${currentList.length}`;
                
                // í˜„ì¬ ìƒíƒœ ë²„íŠ¼ í•˜ì´ë¼ì´íŠ¸
                updateStatusButtons(item.status);
            }, 200);
        }

        function renderEmpty() {
            document.getElementById('card-main-text').innerText = "ì¹´ë“œ ì—†ìŒ";
            document.getElementById('card-sub-text').innerText = "í•´ë‹¹í•˜ëŠ” ë‹¨ì–´ê°€ ì—†ìŠµë‹ˆë‹¤.";
            document.getElementById('card-desc-text').innerText = "";
            document.getElementById('card-counter').innerText = "0 / 0";
        }

        function updateStatusButtons(currentStatus) {
            ['unknown', 'ambiguous', 'memorized'].forEach(status => {
                const btn = document.getElementById(`btn-status-${status}`);
                btn.classList.remove('ring-4', 'ring-indigo-300'); // ê¸°ì¡´ ë§ ì œê±°
                if (status === currentStatus) {
                    btn.classList.add('ring-4', 'ring-indigo-300'); // ì„ íƒ í‘œì‹œ
                }
            });
        }

        // --- ì¸í„°ë™ì…˜ ---
        window.flipCard = function() {
            document.getElementById('card').classList.toggle('flipped');
        }

        window.toggleExample = function() {
            const area = document.getElementById('example-area');
            area.classList.toggle('hidden');
        }

        window.toggleMode = function() {
            isReverseMode = document.getElementById('mode-toggle').checked;
            renderCard();
        }

        window.nextCard = function() {
            if (currentList.length === 0) return;
            currentIndex = (currentIndex + 1) % currentList.length;
            renderCard();
        }

        window.prevCard = function() {
            if (currentList.length === 0) return;
            currentIndex = (currentIndex - 1 + currentList.length) % currentList.length;
            renderCard();
        }

        // --- Firebase ì—…ë°ì´íŠ¸ ---
        window.updateStatus = function(newStatus) {
            if (currentList.length === 0) return;
            const currentItem = currentList[currentIndex];
            const word = currentItem.Word;

            // Firebaseì— ì €ì¥
            window.set(window.ref(window.db, 'users/' + userSyncId + '/' + word), newStatus)
                .then(() => {
                    // ì„±ê³µ ì‹œ UI ì¦‰ì‹œ ë°˜ì˜ (ë¦¬ìŠ¤ë„ˆê°€ ì²˜ë¦¬í•˜ì§€ë§Œ ë¹ ë¥¸ ë°˜ì‘ì„ ìœ„í•´)
                    // (onValue ë¦¬ìŠ¤ë„ˆê°€ ë‹¤ì‹œ í˜¸ì¶œë˜ì–´ applyFilterë¥¼ ì‹¤í–‰í•˜ë¯€ë¡œ ìë™ìœ¼ë¡œ ì²˜ë¦¬ë¨)
                })
                .catch((error) => {
                    alert("ë™ê¸°í™” ì‹¤íŒ¨: " + error.message);
                });
        }

        // --- ì‚¬ì´ë“œë°” ë¡œì§ ---
        window.toggleSidebar = function() {
            const sb = document.getElementById('sidebar');
            const ol = document.getElementById('sidebar-overlay');
            if (sb.classList.contains('closed')) {
                sb.classList.remove('closed');
                sb.classList.add('open');
                ol.classList.remove('hidden');
            } else {
                sb.classList.remove('open');
                sb.classList.add('closed');
                ol.classList.add('hidden');
            }
        }

        window.renderSidebar = function() {
            const container = document.getElementById('sidebar-content');
            container.innerHTML = '';

            // ìƒíƒœë³„ ê·¸ë£¹í™”
            const groups = { unknown: [], ambiguous: [], memorized: [] };
            rawVocabulary.forEach(item => {
                const st = statusData[item.Word] || 'unknown';
                groups[st].push(item);
            });

            const labels = { unknown: 'ğŸ”´ ëª»ì™¸ì›€', ambiguous: 'ğŸŸ¡ ì• ë§¤í•¨', memorized: 'ğŸŸ¢ ì™¸ì›€' };

            // íŠ¸ë¦¬ ìƒì„±
            for (const [key, list] of Object.entries(groups)) {
                if (list.length === 0) continue;

                const details = document.createElement('details');
                details.open = true; // ê¸°ë³¸ í¼ì¹¨
                
                const summary = document.createElement('summary');
                summary.className = "cursor-pointer font-bold text-gray-700 py-2 select-none list-none flex items-center";
                summary.innerHTML = `<span class="mr-2 transform transition-transform duration-200">â–¶</span> ${labels[key]} (${list.length})`;
                // í™”ì‚´í‘œ íšŒì „ ìŠ¤íƒ€ì¼ (CSS í•„ìš”í•˜ì§€ë§Œ ê°„ë‹¨íˆ í…ìŠ¤íŠ¸ë¡œ ëŒ€ì²´)
                
                const ul = document.createElement('ul');
                ul.className = "pl-4 space-y-1 mt-1 border-l-2 border-gray-100";

                list.forEach(wordItem => {
                    const li = document.createElement('li');
                    li.className = "text-sm text-gray-600 hover:text-indigo-600 cursor-pointer py-1 truncate";
                    li.innerText = `${wordItem.Word} : ${wordItem['Korean Definition']}`;
                    li.onclick = () => jumpToWord(wordItem.Word);
                    ul.appendChild(li);
                });

                details.appendChild(summary);
                details.appendChild(ul);
                container.appendChild(details);
            }
        }

        function jumpToWord(word) {
            // í˜„ì¬ í•„í„°ì—ì„œ í•´ë‹¹ ë‹¨ì–´ê°€ ìˆëŠ”ì§€ í™•ì¸
            // ìˆìœ¼ë©´ ì´ë™, ì—†ìœ¼ë©´ í•„í„°ë¥¼ 'all'ë¡œ ë°”ê¾¸ê³  ì´ë™
            let targetIndex = currentList.findIndex(item => item.Word === word);
            
            if (targetIndex === -1) {
                // í˜„ì¬ í•„í„° ë¦¬ìŠ¤íŠ¸ì— ì—†ìœ¼ë©´ ì „ì²´ ë³´ê¸°ë¡œ ê°•ì œ ì „í™˜
                window.setFilter('all');
                targetIndex = currentList.findIndex(item => item.Word === word);
                document.getElementById('btn-filter-all').click(); // UI ë™ê¸°í™”
            }

            if (targetIndex !== -1) {
                currentIndex = targetIndex;
                renderCard();
                toggleSidebar(); // ì‚¬ì´ë“œë°” ë‹«ê¸°
            }
        }
        
        // í‚¤ë³´ë“œ ì´ë²¤íŠ¸
        document.addEventListener('keydown', (e) => {
            if(e.key === 'ArrowRight') nextCard();
            else if(e.key === 'ArrowLeft') prevCard();
            else if(e.key === ' ') { e.preventDefault(); flipCard(); }
        });

    </script>
</body>
</html>